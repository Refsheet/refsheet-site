if (navigator.serviceWorker) {
    console.log('[Companion]', 'Registering service worker.');

    navigator.serviceWorker.register('/serviceworker.js', { scope: './' })
        .then(function(reg) {
          console.log('[Companion]', 'Service worker registered!');
        });

    window.vapidPublicKey = new Uint8Array(<%= Base64.urlsafe_decode64(Rails.configuration.x.vapid[:public_key]).bytes %>);

    navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
        console.log('[Vapid]', 'Registering VAPID', window.vapidPublicKey);

        serviceWorkerRegistration.pushManager
            .subscribe({
                userVisibleOnly: true,
                applicationServerKey: window.vapidPublicKey
            });
    });
}
