commands:
  01_install_yarn:
    command: "sudo wget https://dl.yarnpkg.com/rpm/yarn.repo -O /etc/yum.repos.d/yarn.repo && curl --silent --location https://rpm.nodesource.com/setup_6.x | sudo bash - && sudo yum install yarn -y"
    test: "[ ! -x /usr/bin/yarn ]"
  02_download_nodejs:
    command: curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
    test: "[ ! -x /usr/bin/node ]"
  03_install_nodejs:
    command: yum -y install nodejs
    test: "[ ! -x /usr/bin/node ]"

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/11a_yarn_install.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      set -xe

      EB_APP_STAGING_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k app_staging_dir)
      cd $EB_APP_STAGING_DIR

      yarn install --cache-folder ./node_modules/.yarn-cache/yarn
